#!/usr/bin/perl

# 0x18 = CDC
# 0x50 = MFL
# 0x68 = RAD
# 0xF0 = BMBT
# 0xFF = LOC

# Tested good
var rad_cdc_device_status_request    = [0x68, 0x18, 0x01];
var rad_cdc_get_current_track        = [0x68, 0x18, 0x38, 0x00, 0x00];
var cdc_loc_device_ready_after_reset = [0x18, 0xFF, 0x02, 0x01];
var cdc_loc_device_ready             = [0x18, 0xFF, 0x02, 0x00];

var cdc_rad_status_not_playing       = [0x18, 0x68, 0x39, 0x00, 0x02, 0x00, 0x3F, 0x00, 0x01, 0x01];
var cdc_statusplaying                = [0x18, 0x68, 0x39, 0x00, 0x09, 0x00, 0x3F, 0x00, 0x01, 0x01];
var cdc_startplaying01               = [0x18, 0x68, 0x39, 0x02, 0x09, 0x00, 0x3F, 0x00, 0x01, 0x00];


# Needs test

var cdc_startplaying01 = [0x18, 0x68, 0x39, 0x02, 0x09, 0x00, 0x3F, 0x00, 0x01, 0x00];
var cdc_startplaying02 = [0x18, 0x68, 0x39, 0x02, 0x09, 0x00, 0x3F, 0x00, 0x02, 0x00];
var cdc_startplaying03 = [0x18, 0x68, 0x39, 0x02, 0x09, 0x00, 0x3F, 0x00, 0x03, 0x00];
var cdc_startplaying04 = [0x18, 0x68, 0x39, 0x02, 0x09, 0x00, 0x3F, 0x00, 0x04, 0x00];
var cdc_startplaying05 = [0x18, 0x68, 0x39, 0x02, 0x09, 0x00, 0x3F, 0x00, 0x05, 0x00];
var cdc_startplaying06 = [0x18, 0x68, 0x39, 0x02, 0x09, 0x00, 0x3F, 0x00, 0x06, 0x00];
var cdc_endplaying     = [0x18, 0x68, 0x39, 0x07, 0x09, 0x00, 0x3F, 0x00, 0x01, 0x01];

var cdc_seek1          = [0x18, 0x68, 0x39, 0x08, 0x09, 0x00, 0x3F, 0x00, 0x01, 0x00];
var cdc_scanfwd        = [0x18, 0x68, 0x39, 0x03, 0x09, 0x00, 0x3F, 0x00, 0x02, 0x03];
var cdc_scanback       = [0x18, 0x68, 0x39, 0x04, 0x09, 0x00, 0x3F, 0x00, 0x02, 0x03];

var rad_cdstopplaying  = [0x68, 0x18, 0x38, 0x01, 0x00];
var rad_cdreqtoplay    = [0x68, 0x18, 0x38, 0x03, 0x00];
var rad_cdreqtoplay2   = [0x68, 0x18, 0x38, 0x02, 0x00];

var mfl_radpushnext    = [0x50, 0x68, 0x3b, 0x01];
var mfl_radpushprev    = [0x50, 0x68, 0x3b, 0x08];

var bmbt_radpushnext   = [0xF0, 0x68, 0x48, 0x00];
var bmbt_radpushprev   = [0xF0, 0x68, 0x48, 0x10];


if(lexer($rad_cdpoll)) {
  print "\nPolled by Head Unit\n";
  CDC.send($cd_pollresp); # Send Announce message
}

if(lexer($rad_cdreqtoplay)) {
  print "\nRequest to Play\nSending status playing\n";
  CDC.send($cd_statusplaying);
  CDC.send($cd_startplaying01);
  $playing = 1;
}

if(lexer($rad_cdreqtoplay2)) {
  print "\nRequest to Play2\nSending status playing\n";
  CDC.send($cd_startplaying01);
  $playing = 1;
}

if(lexer($rad_cdstopplaying)) {
  print "\nRequest to Stop\nSending status not playing\n";
  CDC.send($cd_statusnotplaying);
  $playing = 0;
}

if(lexer($rad_cdgetcurrenttk)) {
  print "\nRequest Current Track\n";

  if($playing) {
    print "Sending status playing\n";
    CDC.send($cd_startplaying01);
  }

  else {
    print "Sending status not playing\n";
    CDC.send($cd_statusnotplaying);
  }
}

if(lexer($bmb_radpushnext)) {
  print "\nNext Song\n";
}

if(lexer($bmb_radpushprev)) {
  print "\nPrev Song\n";
}

if(lexer($stw_radpushnext)) {
  print "\nSteering Wheel Next Song\n";
}

if(lexer($stw_radpushprev)) {
  print "\nSteering Wheel Previous Song\n";
}

